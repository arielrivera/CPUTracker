<div class="container mt-4">
    <!-- Top bar for Advanced Search -->
    <div class="card mb-4">
        <div class="card-header">
            Advanced Search
        </div>
        <div class="card-body bg-light">
            <form id="advancedSearchForm">
                <div class="form-row">
                    <!-- Date or date range selection control -->
                    <div class="col-md-3 mb-3" data-provide="datepicker">
                        <label for="dateRange">Date Range</label>
                       <input type="text" class="form-control" id="dateRange" name="dateRange" placeholder="Select date range">
                          
                    </div>
                    <!-- Part number dropdown -->
                    <div class="col-md-3 mb-3">
                        <label for="partNumber">Part Number</label>
                        <select class="form-control" id="partNumber" name="partNumber">
                            <option value="any">Any</option>
                            {% if parts %}
                            {% for part in parts %}
                            <option value="{{ part.part_number }}">{{ part.part_number }}</option>
                            {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <!-- Result dropdown -->
                    <div class="col-md-3 mb-3">
                        <label for="result">Result</label>
                        <select class="form-control" id="result" name="result">
                            <option value="any">Any</option>
                                <option value="NFF">Pass (NFF)</option>
                                <option value="VF">Fail (VF)</option>
                                <option value="VM/PPS">Scrap (VM/PPS)</option>
                                <option value="TESTING">Test in progress</option>
                                <option value="Unknown">Unknown</option>
                            
                        </select>
                    </div>
                    <!-- Date code input -->
                    <div class="col-md-3 mb-3">
                        <label for="dateCode">Date Code</label>
                        <input type="text" class="form-control" id="datecode" list="datecodeSuggestions">
                        <datalist id="datecodeSuggestions">
                            <!-- Suggestions will be populated dynamically -->
                        </datalist>
                    </div>
                    <!-- Raw Failure contains input -->
                    <div class="col-md-3 mb-3">
                        <label for="rawFailure">Raw Failure Contains</label>
                        <input type="text" class="form-control" id="rawFailure" name="rawFailure" placeholder="Enter Raw Failure">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="reportSubmit">Submit</button>
            </form>
        </div>
    </div>

    <div id="reports-alert-message" class="alert alert-danger" role="alert" style="display: none;">
        <!-- Messages area  -->
    </div>

    <!-- Button options section -->
    <div id="buttonOptions" class="mb-4" style="display: none;">
        <button class="btn btn-secondary">Foxcon Report</button>
        <button class="btn btn-secondary">Export as CSV</button>
        <button class="btn btn-secondary">Export as HTML</button>
    </div>

    <!-- Search results section -->
    <div id="searchResults">
        <table class="table table-bordered" id="adv-search-results">
            <thead>
                <tr>
                    <th>Column 1</th>
                    <th>Column 2</th>
                    <th>Column 3</th>
                    <th>Column 3</th>
                    <th>Column 3</th>
                    <th>Column 3</th>
                    <th>Column 3</th>
                    <!-- Add more columns as needed -->
                </tr>
            </thead>
            <tbody>
                <!-- Populate with search results dynamically -->
            </tbody>
        </table>
    </div>
</div>

<!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script> -->
<script>
    $(document).ready(function() {
        // Initialize the datepicker
        $('#dateRange').datepicker({
            format: 'yyyy-mm-dd',
            todayHighlight: true,
            autoclose: true,
            clearBtn: true,
            inputs: $('.actual_range')
        });

        $('#advancedSearchForm').on('submit', function(event) {
            event.preventDefault();


            console.log('Report submit Button clicked');
            event.preventDefault();
            
            // Retrieve the values from the input fields
            let dateRangeValue = $('#dateRange').val();
            let partNumberValue = $('#partNumber').val();
            let resultValue = $('#result').val();
            let dateCodeValue = $('#datecode').val();
            let rawFailureValue = $('#rawFailure').val();

            $.ajax({
                url: '/advanced_search',
                method: 'POST',
                data: {
                    date_range: dateRangeValue,
                    part_number: partNumberValue,
                    test_result: resultValue,
                    datecode: dateCodeValue,
                    raw_failure: rawFailureValue
                    
                },
                success: function(response) {
                    // Handle the response
                    console.log('Search Response:', response);
                    // Check if the response is successful and contains the expected fields
                    if (response.results && Array.isArray(response.results)) 
                    {
                        // Clear existing table rows
                        $('#adv-search-results tbody').empty();
                        response.results.forEach(result => 
                        {
                            if (result.serial_number && result.part_number) 
                            {
                                // Append new rows to the table
                                var row = '<tr comp_snpn="' + result.composite_snpn + '" record_id="' + result.id + '" class="' + getRowClass(result.test_result) + '">' +
                                    '<td class="text-nowrap">' + result.datecode + '</td>' +
                                    '<td>' + result.serial_number + '</td>' +
                                    '<td class="text-nowrap">' + result.part_number + '</td>' +
                                    '<td>' + result.datecode + '</td>' +
                                    '<td>' + result.country + '</td>' +
                                    '<td class="raw-failure-column"><span class="cell-content">' + result.raw_failure + '</span></td>' +
                                    '<td>' + result.test_result + '</td>' +
                                    '</tr>';
                                $('#adv-search-results tbody').append(row);
                            } else 
                            {
                                console.error('Missing expected fields in result:', result);
                            }
                        });
                    } else {
                        console.error('Invalid response:', response);
                    }
                }

            });
                
        });





            $('#buttonOptions').show();
            // Populate the search results table with dummy data for demonstration
            $('#searchResults tbody').html(`
                <tr>
                    <td>Data 1</td>
                    <td>Data 2</td>
                    <td>Data 3</td>
                </tr>
                <tr>
                    <td>Data 4</td>
                    <td>Data 5</td>
                    <td>Data 6</td>
                </tr>
            `);
        
    
    
        $('.dateRange').datepicker({ format: "yyyy-mm-dd" });


        // Fetch datecode suggestions
        function fetchDatecodeSuggestions(query) {
            return $.ajax({
                url: '/get_datecode_suggestions',
                method: 'GET',
                data: { query: query }
            });
        }

        // Handle datecode input for suggestions
        $('#datecode').on('input', function() {
                    const query = $(this).val();
                    fetchDatecodeSuggestions(query).done(function(data) {
                        const suggestions = $('#datecodeSuggestions');
                        suggestions.empty();
                        data.forEach(datecode => {
                            suggestions.append(new Option(datecode, datecode));
                        });
                    });
                });




    
    });
</script>